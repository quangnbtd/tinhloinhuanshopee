<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng C·ª• T√≠nh L·ª£i Nhu·∫≠n Shopee Hi·ªán ƒê·∫°i V7 - V≈© Quang Ecommerce</title>
    <style>
        :root {
            --primary-color: #ee4d2d;
            --primary-color-dark: #d73210;
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --text-color: #343a40;
            --text-color-light: #6c757d;
            --text-color-footer: #6c757d;
            --note-color: #6c757d;
            --border-color: #dee2e6;
            --input-bg: #fff;
            --background-color: #f8f9fa;
            --white: #fff;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
            --box-shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.08);
            --border-radius: 0.375rem;
            --border-radius-lg: 0.5rem;
            --transition-speed: 0.25s;
            --tooltip-bg: #343a40;
            --tooltip-text: #fff;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            min-height: 100vh;
            padding: 15px; /* Gi·∫£m padding body cho m√†n h√¨nh nh·ªè */
        }

        .container {
            background-color: var(--white);
            /* Mobile First Padding */
            padding: 30px 20px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--box-shadow-lg);
            max-width: 700px;
            width: 100%;
            margin-top: 20px; /* Gi·∫£m margin top */
            margin-bottom: 20px; /* Gi·∫£m margin bottom */
            flex-shrink: 0;
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 10px;
            /* Mobile First Font Size */
            font-size: 1.8em;
            font-weight: 700;
        }

        .luu-y {
            text-align: center;
            font-size: 0.9em; /* Gi·∫£m nh·∫π font size */
            color: var(--text-color-light);
            margin-bottom: 25px; /* ƒêi·ªÅu ch·ªânh margin */
            background-color: #fff3cd;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            border: 1px solid #ffeeba;
        }

        fieldset {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 20px; /* Gi·∫£m padding fieldset */
            margin-bottom: 25px; /* ƒêi·ªÅu ch·ªânh margin */
            background-color: var(--white);
            box-shadow: var(--box-shadow);
            transition: box-shadow var(--transition-speed) ease, border-color var(--transition-speed) ease;
        }

        fieldset:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(238, 77, 45, 0.1);
        }

        legend {
            padding: 0 10px; /* Gi·∫£m padding legend */
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.15em; /* Gi·∫£m nh·∫π font size legend */
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px; /* Gi·∫£m margin bottom m·∫∑c ƒë·ªãnh */
            position: relative;
        }
        .form-group:last-child { margin-bottom: 0; }

        label {
            display: inline-flex;
            align-items: center;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.95em; /* Gi·∫£m nh·∫π font size label */
        }

        .info-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 18px;
            height: 18px;
            background-color: #e9ecef;
            color: var(--text-color-light);
            border-radius: 50%;
            font-size: 11px;
            font-weight: bold;
            font-style: normal;
            cursor: pointer;
            margin-left: 6px;
            user-select: none;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .info-icon:hover {
            background-color: var(--primary-color);
            color: var(--white);
        }

        input[type="number"], input[type="text"], select {
            width: 100%;
            padding: 10px 12px; /* Gi·∫£m nh·∫π padding input */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1em;
            color: var(--text-color);
            background-color: var(--input-bg);
            transition: border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }

        input[type="number"]:focus, input[type="text"]:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(238, 77, 45, 0.1); /* Gi·∫£m nh·∫π spread c·ªßa shadow */
        }

        input[type="number"]:disabled, select:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
            opacity: 0.7;
        }

        #phiCoDinhDisplay {
            font-weight: 700;
            color: var(--primary-color);
            padding: 8px 0;
            font-size: 1em; /* ƒêi·ªÅu ch·ªânh font size */
        }

        input[type="checkbox"] { margin-right: 8px; width: 17px; height: 17px; accent-color: var(--primary-color); cursor: pointer; }
        .checkbox-label { display: inline-flex; align-items: center; font-weight: 500; color: var(--text-color); cursor: pointer; user-select: none; margin-bottom: 0; }
        .checkbox-label span { line-height: 1.2; }
        .checkbox-group { display: flex; flex-direction: column; gap: 12px; padding-top: 8px; }

        /* --- MOBILE FIRST INPUT ROW --- */
        .input-row {
            display: flex;
            flex-direction: column; /* X·∫øp ch·ªìng m·∫∑c ƒë·ªãnh */
            gap: 15px; /* Kho·∫£ng c√°ch d·ªçc gi·ªØa c√°c item */
        }

        .input-row .form-group {
            margin-bottom: 0; /* X√≥a margin bottom v√¨ ƒë√£ d√πng gap */
            /* Kh√¥ng c·∫ßn flex: 1 ·ªü ƒë√¢y */
        }

        /* ƒê·∫£m b·∫£o n√∫t chi·∫øm ƒë·ªß r·ªông khi x·∫øp ch·ªìng */
        .input-row > button {
             width: 100%;
             margin-top: 0; /* Reset margin-top n·∫øu c√≥ */
        }
        /* N√∫t ƒë·∫ßu ti√™n trong row c√≥ th·ªÉ c·∫ßn margin-top n·∫øu tr∆∞·ªõc ƒë√≥ l√† input */
         .input-row > button:first-child {
             margin-top: 5px;
         }


        button#tinhToanBtn, button#resetBtn {
            display: block; /* Gi·ªØ block */
            /* width: 100% ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω b·ªüi .input-row > button */
            padding: 12px 15px; /* Gi·∫£m nh·∫π padding n√∫t */
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.05em; /* Gi·∫£m nh·∫π font size n√∫t */
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            /* margin-top: 15px; /* Lo·∫°i b·ªè margin-top c·ªë ƒë·ªãnh ·ªü ƒë√¢y */
        }

        button#tinhToanBtn {
            background-image: linear-gradient(to right, var(--primary-color), #f06d50);
            background-size: 200% auto;
            color: var(--white);
            box-shadow: 0 4px 10px rgba(238, 77, 45, 0.3);
        }

        button#tinhToanBtn:hover {
            background-position: right center;
            box-shadow: 0 6px 15px rgba(238, 77, 45, 0.4);
        }

        button#tinhToanBtn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 5px rgba(238, 77, 45, 0.3);
        }

        button#resetBtn {
            background-color: var(--text-color-light);
            color: var(--white);
        }

        button#resetBtn:hover {
            background-color: #5a6268;
        }

        button#resetBtn:active {
            transform: scale(0.98);
        }

        #ketQuaTrucTiep {
            margin-top: 25px; /* ƒêi·ªÅu ch·ªânh margin */
            padding: 20px 25px; /* Gi·∫£m padding k·∫øt qu·∫£ */
            border-radius: var(--border-radius-lg);
            background-color: var(--white);
            border: 1px solid var(--border-color);
            border-left-width: 5px;
            border-left-color: var(--border-color);
            text-align: center;
            font-size: 1em; /* Gi·∫£m nh·∫π font size k·∫øt qu·∫£ */
            line-height: 1.6;
            box-shadow: var(--box-shadow);
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transform: translateY(10px);
            transition: opacity 0.4s ease-out, transform 0.4s ease-out, max-height 0.4s ease-out, border-left-color 0.4s ease, background-color 0.4s ease;
        }

        #ketQuaTrucTiep.visible {
            opacity: 1;
            transform: translateY(0);
            max-height: 500px; /* ƒê·∫£m b·∫£o ƒë·ªß cao */
        }

        #ketQuaTrucTiep.result-positive { border-left-color: var(--success-color); background-color: #f0fff4; }
        #ketQuaTrucTiep.result-negative { border-left-color: var(--error-color); background-color: #fff5f5; }
        #ketQuaTrucTiep.result-zero { border-left-color: var(--warning-color); background-color: #fffcf0; }

        #ketQuaTrucTiep .result-text { margin-bottom: 5px; }
        #ketQuaTrucTiep .result-amount { font-size: 1.6em; font-weight: 700; display: block; margin-bottom: 10px; } /* Gi·∫£m font size s·ªë ti·ªÅn */
        #ketQuaTrucTiep .sub-info { color: var(--text-color-light); font-size: 0.85em; display: block; margin-top: 10px; line-height: 1.4; } /* Gi·∫£m font size sub-info */

        .positive { color: var(--success-color); }
        .negative { color: var(--error-color); }
        .zero { color: var(--warning-color); }

        .error {
            color: var(--error-color);
            font-size: 0.8em;
            margin-top: 5px;
            min-height: 1.1em; /* Gi·∫£m nh·∫π font size l·ªói */
        }

        footer { text-align: center; padding: 15px; margin-top: auto; width: 100%; font-size: 0.85em; color: var(--text-color-footer); } /* Gi·∫£m padding v√† font size footer */
        footer p { margin-bottom: 5px; }
        footer a { color: var(--primary-color); text-decoration: none; transition: color var(--transition-speed) ease; }
        footer a:hover { color: var(--primary-color-dark); text-decoration: underline; }

        #tooltip-box {
            position: absolute;
            background-color: var(--tooltip-bg);
            color: var(--tooltip-text);
            padding: 8px 12px; /* Gi·∫£m padding tooltip */
            border-radius: var(--border-radius);
            font-size: 0.85em; /* Gi·∫£m font size tooltip */
            line-height: 1.4;
            max-width: min(280px, 85vw); /* ƒêi·ªÅu ch·ªânh max-width */
            word-wrap: break-word;
            z-index: 1000;
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
            pointer-events: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        #tooltip-box.visible {
            opacity: 1;
        }

        /* --- MEDIA QUERIES FOR LARGER SCREENS --- */

        /* Small devices (landscape phones, 576px and up) */
        @media (min-width: 576px) {
            body {
                padding: 20px; /* TƒÉng l·∫°i padding body */
            }
             h1 {
                 font-size: 2em; /* TƒÉng l·∫°i font size h1 */
             }
            .input-row {
                flex-direction: row; /* Chuy·ªÉn sang h√†ng ngang */
                gap: 20px; /* Kho·∫£ng c√°ch ngang */
                align-items: flex-start; /* CƒÉn ch·ªânh theo ƒë·∫ßu */
            }
            .input-row .form-group {
                 flex: 1; /* Chia ƒë·ªÅu kh√¥ng gian */
            }
            /* Cho ph√©p n√∫t chi·∫øm kh√¥ng gian linh ho·∫°t khi n·∫±m ngang */
             .input-row > button {
                 width: auto;
                 flex: 1; /* Chia ƒë·ªÅu kh√¥ng gian cho 2 n√∫t */
                 margin-top: 0; /* Reset margin-top */
             }
            /* Reset margin top cho n√∫t ƒë·∫ßu ti√™n n·∫øu n√≥ n·∫±m ngang */
             .input-row > button:first-child {
                 margin-top: 0;
             }

             button#tinhToanBtn, button#resetBtn {
                 padding: 15px; /* TƒÉng l·∫°i padding n√∫t */
                 font-size: 1.15em; /* TƒÉng l·∫°i font size n√∫t */
             }
             #ketQuaTrucTiep .result-amount { font-size: 1.8em; } /* TƒÉng l·∫°i font size s·ªë ti·ªÅn */
             #ketQuaTrucTiep .sub-info { font-size: 0.9em; } /* TƒÉng l·∫°i font size sub-info */
        }

        /* Medium devices (tablets, 768px and up) */
        @media (min-width: 768px) {
            .container {
                padding: 35px 40px; /* TƒÉng padding container */
                margin-top: 30px;
                margin-bottom: 30px;
            }
             fieldset {
                 padding: 20px 25px 25px 25px; /* TƒÉng l·∫°i padding fieldset */
                 margin-bottom: 30px;
             }
             legend {
                 padding: 0 15px; /* TƒÉng l·∫°i padding legend */
                 font-size: 1.2em; /* TƒÉng l·∫°i font size legend */
             }
             label {
                 font-size: 1em; /* TƒÉng l·∫°i font size label */
             }
             input[type="number"], input[type="text"], select {
                 padding: 12px 15px; /* TƒÉng l·∫°i padding input */
             }
             #ketQuaTrucTiep {
                 padding: 25px 30px; /* TƒÉng l·∫°i padding k·∫øt qu·∫£ */
                 font-size: 1.1em; /* TƒÉng l·∫°i font size k·∫øt qu·∫£ */
                 margin-top: 30px;
             }
             footer {
                 padding: 20px 15px;
                 font-size: 0.9em; /* TƒÉng l·∫°i font size footer */
             }
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>C√¥ng C·ª• T√≠nh L·ª£i Nhu·∫≠n Shopee C·∫≠p Nh·∫≠p 2025</h1>
        <p class="luu-y">Nh·∫≠p th√¥ng tin gi√° v√† c√°c lo·∫°i chi ph√≠ d·ª± ki·∫øn ƒë·ªÉ ∆∞·ªõc t√≠nh l·ª£i nhu·∫≠n.</p>

        <form id="shopee-profit-form">
            <!-- TH√îNG TIN C∆† B·∫¢N -->
            <fieldset>
                <legend>Th√¥ng Tin S·∫£n Ph·∫©m</legend>
                <div class="input-row">
                    <div class="form-group">
                        <label for="giaNhap">Gi√° Nh·∫≠p (VNƒê)</label>
                        <input type="number" id="giaNhap" placeholder="Gi√° v·ªën s·∫£n ph·∫©m" required min="0" aria-describedby="errorGiaNhap">
                        <div class="error" id="errorGiaNhap" aria-live="polite"></div>  
                    </div>
                    <div class="form-group">
                        <label for="giaBan">Gi√° B√°n Shopee (VNƒê)</label>
                        <input type="number" id="giaBan" placeholder="Gi√° hi·ªÉn th·ªã tr√™n Shopee" required min="0" aria-describedby="errorGiaBan">
                        <div class="error" id="errorGiaBan" aria-live="polite"></div>  
                    </div>
                </div>
            </fieldset>

            <!-- PH√ç S√ÄN -->
            <fieldset>
                <legend>Ph√≠ S√†n</legend>
                <div class="input-row">
                    <div class="form-group">
                        <label for="nganhHangL1">Ng√†nh h√†ng C·∫•p 1</label>
                        <select id="nganhHangL1" required aria-describedby="errorNganhHangL1">
                            <option value="">-- Ch·ªçn C·∫•p 1 --</option>
                        </select>
                        <div class="error" id="errorNganhHangL1" aria-live="polite"></div>  
                    </div>
                    <div class="form-group">
                        <label for="nganhHangL2">Ng√†nh h√†ng C·∫•p 2</label>
                        <select id="nganhHangL2" required disabled aria-describedby="errorNganhHangL2">
                            <option value="">-- Ch·ªçn C·∫•p 2 --</option>
                        </select>
                        <div class="error" id="errorNganhHangL2" aria-live="polite"></div>  
                    </div>
                </div>
                <div class="form-group">
                    <label>Ph√≠ C·ªë ƒê·ªãnh (Hoa h·ªìng) t·ª± ƒë·ªông:</label>
                    <div id="phiCoDinhDisplay">Ch∆∞a ch·ªçn ng√†nh h√†ng</div>
                </div>
                <hr style="border: none; border-top: 1px solid #eee; margin: 15px 0;">
                <div class="form-group">
                    <label for="tyLeThue">% Thu·∫ø</label>
                    <i class="info-icon" data-tooltip="Thu·∫ø TNCN/TNDN b·∫°n c·∫ßn n·ªôp theo quy ƒë·ªãnh (n·∫øu c√≥).">üó®Ô∏è</i>
                    <input type="number" id="tyLeThue" placeholder="VD: 1.5" step="0.1" value="1.5" required min="0" aria-describedby="errorThue">
                    <div class="error" id="errorThue" aria-live="polite"></div>  
                </div>
                <small style="font-size: 0.8em; color: var(--note-color); display: block; margin-top: -10px;">*Ph√≠ thanh to√°n (~4%) ƒë√£ ƒë∆∞·ª£c t·ª± ƒë·ªông t√≠nh v√†o t·ªïng chi ph√≠.</small>
            </fieldset>

            <!-- CHI PH√ç MARKETING -->
            <fieldset>
                <legend>Chi Ph√≠ Marketing (% tr√™n Gi√° B√°n)</legend>
                <div class="input-row">
                    <div class="form-group">
                        <label for="phanTramQuangCao">% Qu·∫£ng c√°o Shopee</label>
                        <i class="info-icon" data-tooltip="Chi ph√≠ ch·∫°y QC ƒê·∫•u th·∫ßu t·ª´ kh√≥a, Kh√°m ph√°... (VAT 10% s·∫Ω ƒë∆∞·ª£c t√≠nh th√™m tr√™n chi ph√≠ n√†y).">üó®Ô∏è</i>
                        <input type="number" id="phanTramQuangCao" placeholder="VD: 18" step="0.1" value="0" required min="0" aria-describedby="errorQuangCao">
                        <div class="error" id="errorQuangCao" aria-live="polite"></div>  
                    </div>
                    <div class="form-group">
                        <label for="phanTramAffiliate">% Affiliate / TTLK</label>
                        <i class="info-icon" data-tooltip="Chi ph√≠ tr·∫£ cho KOLs, KOCs, Affiliate Program c·ªßa Shopee ho·∫∑c b√™n th·ª© ba.">üó®Ô∏è</i>
                        <input type="number" id="phanTramAffiliate" placeholder="VD: 15" step="0.1" value="0" required min="0" aria-describedby="errorAffiliate">
                        <div class="error" id="errorAffiliate" aria-live="polite"></div>  
                    </div>
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label for="phanTramVoucher">% Voucher / KM</label>
                        <i class="info-icon" data-tooltip="T·ªïng chi ph√≠ b·∫°n ch·ªãu cho Voucher (do b·∫°n t·∫°o), Flash Sale, Combo Khuy·∫øn M√£i...">üó®Ô∏è</i>
                        <input type="number" id="phanTramVoucher" placeholder="VD: 5" step="0.1" value="0" required min="0" aria-describedby="errorVoucher">
                        <div class="error" id="errorVoucher" aria-live="polite"></div>  
                    </div>
                    <div class="form-group">
                        <label for="phanTramMktKhac">% Chi ph√≠ MKT kh√°c</label>
                        <i class="info-icon" data-tooltip="Gom c√°c chi ph√≠ MKT kh√°c nh∆∞: booking live, chi ph√≠ s·∫£n xu·∫•t content, qu·∫£ng c√°o ngo·∫°i s√†n, chi ph√≠ m·∫´u/test...">üó®Ô∏è</i>
                        <input type="number" id="phanTramMktKhac" placeholder="VD: 3" step="0.1" value="0" required min="0" aria-describedby="errorMktKhac">
                        <div class="error" id="errorMktKhac" aria-live="polite"></div>  
                    </div>
                </div>
            </fieldset>

            <!-- V·∫¨N H√ÄNH & R·ª¶I RO -->
            <fieldset>
                <legend>V·∫≠n H√†nh & R·ªßi Ro (% tr√™n Gi√° B√°n)</legend>
                <div class="input-row">
                    <div class="form-group">
                        <label for="tyLeVanHanh">% Ph√≠ V·∫≠n H√†nh</label>
                        <i class="info-icon" data-tooltip="Chi ph√≠ ∆∞·ªõc t√≠nh cho kho b√£i, nh√¢n s·ª±, ƒëi·ªán n∆∞·ªõc, kh·∫•u hao, ph·∫ßn m·ªÅm...">üó®Ô∏è</i>
                        <input type="number" id="tyLeVanHanh" placeholder="VD: 5" step="0.1" value="0" required min="0" aria-describedby="errorVanHanh">
                        <div class="error" id="errorVanHanh" aria-live="polite"></div>  
                    </div>
                    <div class="form-group">
                        <label for="tyLeBatThuong">% Ph√≠ B·∫•t Th∆∞·ªùng</label>
                        <i class="info-icon" data-tooltip="Chi ph√≠ d·ª± ph√≤ng cho c√°c r·ªßi ro nh∆∞ h√†ng h·ªèng nh·∫π, m·∫•t m√°t nh·ªè, bi·∫øn ƒë·ªông gi√°...">üó®Ô∏è</i>
                        <input type="number" id="tyLeBatThuong" placeholder="VD: 2" step="0.1" value="0" required min="0" aria-describedby="errorBatThuong">
                        <div class="error" id="errorBatThuong" aria-live="polite"></div>  
                    </div>
                </div>
            </fieldset>

            <!-- CH∆Ø∆†NG TR√åNH SHOPEE -->
            <fieldset>
                <legend>Ch∆∞∆°ng Tr√¨nh Shopee</legend>
                <div class="checkbox-group">
                    <div class="form-group">
                        <label class="checkbox-label" for="useVoucherXtra">
                            <input type="checkbox" id="useVoucherXtra">
                            <span>Tham gia Voucher Xtra?</span>
                            <i class="info-icon" data-tooltip="Ph√≠ d·ªãch v·ª• Voucher Xtra (~5%, t·ªëi ƒëa 20.000ƒë/s·∫£n ph·∫©m). Ki·ªÉm tra bi·ªÉu ph√≠ m·ªõi nh·∫•t tr√™n K√™nh Ng∆∞·ªùi B√°n.">üó®Ô∏è</i>
                        </label>
                    </div>
                </div>
            </fieldset>

            <!-- CHI PH√ç KH√ÅC (VNƒê / ƒê∆†N) -->
            <fieldset>
                <legend>Chi Ph√≠ Kh√°c (VNƒê / ƒë∆°n)</legend>
                <div class="input-row">
                    <div class="form-group">
                        <label for="chiPhiDongGoi">ƒê√≥ng g√≥i / X·ª≠ l√Ω</label>
                        <i class="info-icon" data-tooltip="Chi ph√≠ cho m·ªói ƒë∆°n h√†ng: h·ªôp carton, t√∫i g√≥i h√†ng, bƒÉng keo, x·ªëp, in ƒë∆°n...">üó®Ô∏è</i>
                        <input type="number" id="chiPhiDongGoi" placeholder="VD: 2000" step="100" value="0" required min="0" aria-describedby="errorDongGoi">
                        <div class="error" id="errorDongGoi" aria-live="polite"></div>  
                    </div>
                    <div class="form-group">
                        <label for="chiPhiMktCoDinh">MKT c·ªë ƒë·ªãnh</label>
                        <i class="info-icon" data-tooltip="Chi ph√≠ c·ªë ƒë·ªãnh tr√™n m·ªói ƒë∆°n cho qu√† t·∫∑ng k√®m, h√†ng sample...">üó®Ô∏è</i>
                        <input type="number" id="chiPhiMktCoDinh" placeholder="VD: 1000" step="100" value="0" required min="0" aria-describedby="errorMktCoDinh">
                        <div class="error" id="errorMktCoDinh" aria-live="polite"></div>  
                    </div>
                </div>
            </fieldset>

            <!-- CHI PH√ç HO√ÄN H√ÄNG -->
            <fieldset>
                <legend>Chi Ph√≠ Ho√†n H√†ng (∆Ø·ªõc t√≠nh)</legend>
                <div class="input-row">
                    <div class="form-group">
                        <label for="tyLeHoan">% T·ª∑ l·ªá ho√†n h√†ng</label>
                        <i class="info-icon" data-tooltip="T·ª∑ l·ªá % ƒë∆°n h√†ng d·ª± ki·∫øn s·∫Ω b·ªã ng∆∞·ªùi mua tr·∫£ h√†ng / ho√†n ti·ªÅn.">üó®Ô∏è</i>
                        <input type="number" id="tyLeHoan" placeholder="VD: 2" step="0.1" value="0" required min="0" aria-describedby="errorTyLeHoan">
                        <div class="error" id="errorTyLeHoan" aria-live="polite"></div>  
                    </div>
                    <div class="form-group">
                        <label for="chiPhiXuLyHoan">Ph√≠ x·ª≠ l√Ω / ƒë∆°n ho√†n</label>
                        <i class="info-icon" data-tooltip="Chi ph√≠ b·∫°n ph·∫£i ch·ªãu cho m·ªói ƒë∆°n b·ªã ho√†n: ph√≠ v·∫≠n chuy·ªÉn chi·ªÅu v·ªÅ (n·∫øu c√≥), hao h·ª•t gi√° tr·ªã h√†ng h√≥a, chi ph√≠ x·ª≠ l√Ω l·∫°i...">üó®Ô∏è</i>
                        <input type="number" id="chiPhiXuLyHoan" placeholder="VD: 15000" step="100" value="0" required min="0" aria-describedby="errorXuLyHoan">
                        <div class="error" id="errorXuLyHoan" aria-live="polite"></div>  
                    </div>
                </div>
            </fieldset>

            <!-- S·ª≠ d·ª•ng .input-row cho n√∫t b·∫•m -->
            <div class="input-row">
                <button type="button" id="resetBtn">ƒê·∫∑t L·∫°i</button>
                <button type="button" id="tinhToanBtn">T√≠nh L·ª£i Nhu·∫≠n</button>
            </div>
        </form>

        <!-- RESULT AREA -->
        <div id="ketQuaTrucTiep" aria-live="polite"></div>  
    </div>

    <footer>
        <p>C√¥ng c·ª• ƒë∆∞·ª£c ph√°t tri·ªÉn b·ªüi <strong>V≈© Quang Ecommerce</strong>.</p>
        <p>
            K·∫øt n·ªëi h·ª£p t√°c: <a href="tel:0386473757">0386 473 757</a> |
            Website: <a href="https://www.vuthanhquang.com/" target="_blank" rel="noopener noreferrer">vuthanhquang.com</a>
        </p>
    </footer>

    <div id="tooltip-box"></div>

<script defer>
    // Configuration constants for easy maintenance
    const CONFIG = {
        TYLE_PHI_THANH_TOAN_CO_DINH: 0.04, // 4%
        TYLE_VAT_QUANG_CAO: 0.10, // 10%
        TYLE_VOUCHER_XTRA: 0.05, // 5%
        MAX_PHI_VOUCHER_XTRA: 20000 // VNƒê
    };

    // Category data (Gi·ªØ nguy√™n)
    const categoryData = [
        { l1: "M√°y t√≠nh & Laptop", l2: "M√°y T√≠nh B√†n", fee: 1.5 }, { l1: "M√°y t√≠nh & Laptop", l2: "Laptop", fee: 1.5 }, { l1: "M√°y t√≠nh & Laptop", l2: "M√†n H√¨nh", fee: 1.5 },
        { l1: "ƒêi·ªán Tho·∫°i & Ph·ª• Ki·ªán", l2: "ƒêi·ªán tho·∫°i", fee: 1.5 }, { l1: "ƒêi·ªán Tho·∫°i & Ph·ª• Ki·ªán", l2: "M√°y t√≠nh b·∫£ng", fee: 1.5 },
        { l1: "Thi·∫øt B·ªã √Çm Thanh", l2: "Amply v√† ƒë·∫ßu ch·ªânh √¢m", fee: 7.0 }, { l1: "Thi·∫øt B·ªã √Çm Thanh", l2: "C√°p √¢m thanh/ video & ƒê·∫ßu chuy·ªÉn", fee: 7.0 }, { l1: "Thi·∫øt B·ªã √Çm Thanh", l2: "Tai nghe nh√©t tai & ch·ª•p tai", fee: 7.0 }, { l1: "Thi·∫øt B·ªã √Çm Thanh", l2: "D√†n √¢m thanh", fee: 7.0 }, { l1: "Thi·∫øt B·ªã √Çm Thanh", l2: "M√°y nghe nh·∫°c", fee: 7.0 }, { l1: "Thi·∫øt B·ªã √Çm Thanh", l2: "Micro thu √¢m", fee: 7.0 },
        { l1: "Cameras & Flycam", l2: "Ph·ª• ki·ªán m√°y ·∫£nh", fee: 7.0 }, { l1: "Cameras & Flycam", l2: "Ph·ª• ki·ªán chƒÉm s√≥c m√°y ·∫£nh", fee: 7.0 }, { l1: "Cameras & Flycam", l2: "M√°y ·∫£nh", fee: 7.0 }, { l1: "Cameras & Flycam", l2: "Ph·ª• ki·ªán Flycam", fee: 7.0 }, { l1: "Cameras & Flycam", l2: "Flycam", fee: 7.0 }, { l1: "Cameras & Flycam", l2: "Ph·ª• ki·ªán ·ªëng k√≠nh", fee: 7.0 }, { l1: "Cameras & Flycam", l2: "·ªêng k√≠nh", fee: 7.0 }, { l1: "Cameras & Flycam", l2: "Camera gi√°m s√°t", fee: 7.0 },
        { l1: "M√°y t√≠nh & Laptop", l2: "Thi·∫øt B·ªã L∆∞u Tr·ªØ", fee: 7.0 }, { l1: "M√°y t√≠nh & Laptop", l2: "Linh Ki·ªán M√°y T√≠nh", fee: 7.0 }, { l1: "M√°y t√≠nh & Laptop", l2: "Chu·ªôt & B√†n Ph√≠m", fee: 7.0 }, { l1: "M√°y t√≠nh & Laptop", l2: "Thi·∫øt B·ªã M·∫°ng", fee: 7.0 }, { l1: "M√°y t√≠nh & Laptop", l2: "Thi·∫øt B·ªã VƒÉn Ph√≤ng", fee: 7.0 }, { l1: "M√°y t√≠nh & Laptop", l2: "Ph·ª• Ki·ªán M√°y T√≠nh", fee: 7.0 }, { l1: "M√°y t√≠nh & Laptop", l2: "M√°y In & M√°y Scan", fee: 7.0 }, { l1: "M√°y t√≠nh & Laptop", l2: "Ph·∫ßn M·ªÅm", fee: 7.0 },
        { l1: "Gaming & Console", l2: "Ph·ª• ki·ªán console", fee: 7.0 }, { l1: "Gaming & Console", l2: "M√°y ch∆°i game", fee: 7.0 }, { l1: "Gaming & Console", l2: "Video Games", fee: 7.0 },
        { l1: "Thi·∫øt B·ªã ƒêi·ªán Gia D·ª•ng", l2: "Pin", fee: 7.0 }, { l1: "Thi·∫øt B·ªã ƒêi·ªán Gia D·ª•ng", l2: "M·∫°ch ƒëi·ªán & Ph·ª• t√πng", fee: 7.0 }, { l1: "Thi·∫øt B·ªã ƒêi·ªán Gia D·ª•ng", l2: "ƒê·ªì gia d·ª•ng nh√† b·∫øp", fee: 7.0 }, { l1: "Thi·∫øt B·ªã ƒêi·ªán Gia D·ª•ng", l2: "Thi·∫øt b·ªã ƒëi·ªán gia d·ª•ng l·ªõn", fee: 7.0 }, { l1: "Thi·∫øt B·ªã ƒêi·ªán Gia D·ª•ng", l2: "M√°y chi·∫øu & Ph·ª• ki·ªán", fee: 7.0 }, { l1: "Thi·∫øt B·ªã ƒêi·ªán Gia D·ª•ng", l2: "Thi·∫øt b·ªã ƒëi·ªÅu khi·ªÉn t·ª´ xa", fee: 7.0 }, { l1: "Thi·∫øt B·ªã ƒêi·ªán Gia D·ª•ng", l2: "Thi·∫øt b·ªã ƒëi·ªán gia d·ª•ng nh·ªè", fee: 7.0 }, { l1: "Thi·∫øt B·ªã ƒêi·ªán Gia D·ª•ng", l2: "Tivi & Ph·ª• ki·ªán", fee: 7.0 },
        { l1: "Th·ªÉ Thao & D√£ Ngo·∫°i", l2: "D·ª•ng C·ª• Th·ªÉ Thao & D√£ Ngo·∫°i", fee: 9.0 }, { l1: "ƒê·ªìng H·ªì", l2: "ƒê·ªìng h·ªì nam", fee: 9.0 }, { l1: "ƒê·ªìng H·ªì", l2: "B·ªô ƒë·ªìng h·ªì & ƒê·ªìng h·ªì c·∫∑p", fee: 9.0 }, { l1: "ƒê·ªìng H·ªì", l2: "ƒê·ªìng h·ªì n·ªØ", fee: 9.0 }, { l1: "Du l·ªãch & H√†nh l√Ω", l2: "Vali", fee: 9.0 },
        { l1: "S·ª©c Kh·ªèe", l2: "Th·ª±c ph·∫©m ch·ª©c nƒÉng", fee: 9.5 }, { l1: "S·ª©c Kh·ªèe", l2: "V·∫≠t t∆∞ y t·∫ø", fee: 9.5 }, { l1: "S·ª©c Kh·ªèe", l2: "ChƒÉm s√≥c c√° nh√¢n", fee: 9.5 },
        { l1: "M·∫π & B√©", l2: "ƒê·ªì d√πng du l·ªãch cho b√©", fee: 9.0 }, { l1: "M·∫π & B√©", l2: "ƒê·ªì d√πng ƒÉn d·∫∑m cho b√©", fee: 9.5 }, { l1: "M·∫π & B√©", l2: "Ph·ª• ki·ªán cho m·∫π", fee: 9.5 }, { l1: "M·∫π & B√©", l2: "ChƒÉm s√≥c s·ª©c kh·ªèe m·∫π", fee: 9.5 }, { l1: "M·∫π & B√©", l2: "ƒê·ªì d√πng ph√≤ng ng·ªß cho b√©", fee: 9.5 }, { l1: "M·∫π & B√©", l2: "ƒê·ªì ch∆°i", fee: 9.5 },
        { l1: "√î t√¥", l2: "√î t√¥", fee: 4.0 }, { l1: "Nh√† c·ª≠a & ƒê·ªùi s·ªëng", l2: "D·ª•ng c·ª• & Thi·∫øt b·ªã ti·ªán √≠ch", fee: 9.5 }, { l1: "M√¥ t√¥, xe m√°y", l2: "M√¥ t√¥, xe m√°y", fee: 4.0 },
        { l1: "ƒêi·ªán Tho·∫°i & Ph·ª• Ki·ªán", l2: "Ph·ª• ki·ªán", fee: 9.0 }, { l1: "ƒêi·ªán Tho·∫°i & Ph·ª• Ki·ªán", l2: "Th·∫ª sim", fee: 9.0 }, { l1: "ƒêi·ªán Tho·∫°i & Ph·ª• Ki·ªán", l2: "B·ªô ƒë√†m", fee: 9.0 }, { l1: "ƒêi·ªán Tho·∫°i & Ph·ª• Ki·ªán", l2: "Thi·∫øt b·ªã ƒëeo th√¥ng minh", fee: 9.0 },
        ...["S·ª± ki·ªán & Gi·∫£i tr√≠", "Nh√† h√†ng & ƒÇn u·ªëng", "Mua s·∫Øm", "Thanh to√°n h√≥a ƒë∆°n", "D·ªãch v·ª• kh√°c", "S·ª©c kh·ªèe & L√†m ƒë·∫πp", "G·ªçi xe", "Kh√≥a h·ªçc", "N·∫°p ti·ªÅn t√†i kho·∫£n", "Du l·ªãch & Kh√°ch s·∫°n", "Ti·ªÅn ƒëi·ªán t·ª≠", "B·∫•t ƒë·ªông s·∫£n", "Th·∫ª game", "Streaming", "M√£ qu√† t·∫∑ng Shopee", "Kh√°c"].map(l2 => ({ l1: "Voucher & D·ªãch v·ª•", l2: l2, fee: 9.0 })),
        { l1: "Th·ªÉ Thao & D√£ Ngo·∫°i", l2: "Ph·ª• Ki·ªán Th·ªÉ Thao & D√£ Ngo·∫°i", fee: 10.0 }, { l1: "Th·ªÉ Thao & D√£ Ngo·∫°i", l2: "Th·ªùi Trang Th·ªÉ Thao & D√£ Ngo·∫°i", fee: 10.0 }, { l1: "Th·ªÉ Thao & D√£ Ngo·∫°i", l2: "Gi√†y Th·ªÉ Thao", fee: 10.0 },
        { l1: "ƒê·ªìng H·ªì", l2: "Ph·ª• ki·ªán ƒë·ªìng h·ªì", fee: 10.0 },
        ...["Ph·ª• ki·ªán tr·∫ª em & tr·∫ª s∆° sinh", "Qu·∫ßn √°o tr·∫ª em", "Bao tay tr·∫ª em & T·∫•t", "Qu·∫ßn √°o b√© trai", "Gi√†y b√© trai", "Qu·∫ßn √°o b√© g√°i", "Gi√†y b√© g√°i"].map(l2 => ({ l1: "Th·ªùi trang tr·∫ª em & tr·∫ª s∆° sinh", l2: l2, fee: 10.0 })),
        ...["B·ªô ph·ª• ki·ªán", "Ph·ª• ki·ªán th√™m", "L·∫Øc ch√¢n", "Th·∫Øt l∆∞ng", "V√≤ng tay & L·∫Øc tay", "B√¥ng tai", "K√≠nh m·∫Øt", "GƒÉng tay", "Ph·ª• ki·ªán t√≥c", "M≈©", "Kim lo·∫°i qu√Ω", "D√¢y chuy·ªÅn", "C√† v·∫°t & N∆° c·ªï", "Nh·∫´n", "KhƒÉn cho√†ng"].map(l2 => ({ l1: "Ph·ª• Ki·ªán Th·ªùi Trang", l2: l2, fee: 10.0 })),
        ...["Ba l√¥", "C·∫∑p x√°ch c√¥ng s·ªü", "V√≠ c·∫ßm tay", "T√∫i ƒëeo ch√©o", "C·∫∑p laptop", "T√∫i tote", "T√∫i ƒëeo h√¥ng & T√∫i ƒëeo ng·ª±c", "B√≥p/ V√≠"].map(l2 => ({ l1: "T√∫i V√≠ Nam", l2: l2, fee: 10.0 })),
        ...["ƒê·ªì h√≥a trang", "Hoodie & √Åo n·ªâ", "ƒê·ªì l√≥t", "√Åo kho√°c", "Qu·∫ßn jean", "Trang ph·ª•c ng√†nh ngh·ªÅ", "Qu·∫ßn d√†i", "B·ªô", "Qu·∫ßn ƒë√πi", "ƒê·ªì ng·ªß", "V·ªõ/ T·∫•t", "Com l√™", "√Åo len", "√Åo", "Trang ph·ª•c truy·ªÅn th·ªëng"].map(l2 => ({ l1: "Th·ªùi Trang Nam", l2: l2, fee: 10.0 })),
        ...["B·ªët", "Gi√†y t√¢y l∆∞·ªùi", "Gi√†y Oxfords & Gi√†y bu·ªôc d√¢y", "XƒÉng-ƒëan & D√©p", "Ph·ª• ki·ªán gi√†y d√©p", "Gi√†y s·ª•c", "Gi√†y th·ªÉ thao/ Sneakers"].map(l2 => ({ l1: "Gi√†y D√©p Nam", l2: l2, fee: 10.0 })),
        { l1: "Du l·ªãch & H√†nh l√Ω", l2: "Ph·ª• ki·ªán du l·ªãch", fee: 10.0 }, { l1: "Du l·ªãch & H√†nh l√Ω", l2: "T√∫i du l·ªãch", fee: 10.0 },
        ...["Ba l√¥", "Ph·ª• ki·ªán t√∫i", "V√≠ d·ª± ti·ªác & V√≠ c·∫ßm tay", "T√∫i ƒëeo ch√©o", "C·∫∑p laptop", "T√∫i quai x√°ch", "T√∫i tote", "T√∫i ƒëeo h√¥ng & T√∫i ƒëeo ng·ª±c", "B√≥p/ V√≠"].map(l2 => ({ l1: "T√∫i V√≠ N·ªØ", l2: l2, fee: 10.0 })),
        ...["ƒê·ªì h√≥a trang", "ƒê·∫ßm", "V·∫£i", "Hoodie & √Åo n·ªâ", "√Åo kho√°c", "Qu·∫ßn jean", "ƒê·ªì li·ªÅn th√¢n", "ƒê·ªì l√≥t", "ƒê·ªì B·∫ßu", "Qu·∫ßn", "B·ªô", "Qu·∫ßn ƒë√πi", "V√°y", "ƒê·ªì ng·ªß", "V·ªõ/ T·∫•t", "√Åo len", "√Åo", "Trang ph·ª•c truy·ªÅn th·ªëng", "V√°y c∆∞·ªõi"].map(l2 => ({ l1: "Th·ªùi Trang N·ªØ", l2: l2, fee: 10.0 })),
        ...["B·ªët", "XƒÉng-ƒëan v√† d√©p", "Gi√†y ƒë·∫ø b·∫±ng", "Gi√†y cao g√≥t", "Ph·ª• ki·ªán gi√†y d√©p", "Gi√†y th·ªÉ thao/ Sneakers", "Gi√†y ƒë·∫ø xu·ªìng"].map(l2 => ({ l1: "Gi√†y D√©p N·ªØ", l2: l2, fee: 10.0 })),
        ...["T·∫Øm & chƒÉm s√≥c c∆° th·ªÉ", "B·ªô s·∫£n ph·∫©m l√†m ƒë·∫πp", "D·ª•ng c·ª• l√†m ƒë·∫πp", "ChƒÉm s√≥c t√≥c", "ChƒÉm s√≥c tay, ch√¢n & m√≥ng", "Trang ƒëi·ªÉm", "ChƒÉm s√≥c nam gi·ªõi", "N∆∞·ªõc hoa", "ChƒÉm s√≥c da m·∫∑t"].map(l2 => ({ l1: "S·∫Øc ƒê·∫πp", l2: l2, fee: 10.0 })),
        { l1: "S·ª©c Kh·ªèe", l2: "H·ªó tr·ª£ t√¨nh d·ª•c", fee: 10.0 },
        ...["ƒê·ªì u·ªëng c√≥ c·ªìn", "C√°c lo·∫°i b√°nh", "ƒê·ªì l√†m b√°nh", "ƒê·ªì u·ªëng", "Ng≈© c·ªëc & m·ª©t", "ƒê·ªì ch·∫ø bi·∫øn s·∫µn", "Nguy√™n li·ªáu n·∫•u ƒÉn", "S·ªØa - tr·ª©ng", "Nhu y·∫øu ph·∫©m", "Th·ª±c ph·∫©m t∆∞∆°i s·ªëng & ƒë√¥ng l·∫°nh", "B·ªô qu√† t·∫∑ng", "ƒê·ªì ƒÉn v·∫∑t"].map(l2 => ({ l1: "Th·ª±c ph·∫©m v√† ƒë·ªì u·ªëng", l2: l2, fee: 10.0 })),
        ...["ChƒÉm s√≥c s·ª©c kh·ªèe b√©", "An to√†n cho b√©", "T·∫Øm & chƒÉm s√≥c c∆° th·ªÉ", "T√£ & b√¥ em b√©", "B·ªô & G√≥i qu√† t·∫∑ng", "S·ªØa c√¥ng th·ª©c & Th·ª±c ph·∫©m cho b√©"].map(l2 => ({ l1: "M·∫π & B√©", l2: l2, fee: 10.0 })),
        ...["V·ªá sinh cho th√∫ c∆∞ng", "Ph·ª• ki·ªán cho th√∫ c∆∞ng", "Qu·∫ßn √°o & ph·ª• ki·ªán", "Th·ª©c ƒÉn cho th√∫ c∆∞ng", "L√†m ƒë·∫πp cho th√∫ c∆∞ng", "ChƒÉm s√≥c s·ª©c kh·ªèe"].map(l2 => ({ l1: "ChƒÉm S√≥c Th√∫ C∆∞ng", l2: l2, fee: 10.0 })),
        ...["Ph·ª• ki·ªán ngo·∫°i th·∫•t √¥ t√¥", "Ph·ª• ki·ªán n·ªôi th·∫•t √¥ t√¥", "Ph·ª• t√πng √¥ t√¥", "ChƒÉm s√≥c √¥ t√¥", "M√≥c ch√¨a kh√≥a v√† B·ªçc ch√¨a √¥ t√¥", "D·∫ßu nh·ªõt v√† ph·ª• gia √¥ t√¥", "D·ª•ng c·ª• s·ª≠a ch·ªØa √¥ t√¥"].map(l2 => ({ l1: "√î t√¥", l2: l2, fee: 10.0 })),
        { l1: "S√°ch & T·∫°p Ch√≠", l2: "S√°ch", fee: 10.0 }, { l1: "S√°ch & T·∫°p Ch√≠", l2: "T·∫°p Ch√≠ & B√°o Gi·∫•y", fee: 10.0 },
        ...["BƒÉng - ƒêƒ©a", "ƒê·ªì S∆∞u T·∫ßm", "Nh·∫°c C·ª• & Ph·ª• Ki·ªán", "D·ª•ng C·ª• May V√°", "Album ·∫¢nh", "Qu√† L∆∞u Ni·ªám", "ƒê·ªì ch∆°i - Gi·∫£i tr√≠", "ƒêƒ©a Than"].map(l2 => ({ l1: "S·ªü th√≠ch & S∆∞u t·∫ßm", l2: l2, fee: 10.0 })),
        ...["ƒê·ªì d√πng ph√≤ng t·∫Øm", "ChƒÉn ga g·ªëi n·ªám", "Trang tr√≠ nh√† c·ª≠a", "B·ªô ƒë·ªì b√†n ƒÉn", "ƒê·ªì th·ªù c√∫ng, ƒë·ªì phong th·ªßy", "N·ªôi th·∫•t", "L√†m v∆∞·ªùn", "T√∫i l√†m ·∫•m", "D·ª•ng c·ª• chƒÉm s√≥c nh√† c·ª≠a", "Ch·∫•t kh·ª≠ m√πi, l√†m th∆°m nh√†", "S·∫Øp x·∫øp nh√† c·ª≠a", "D·ª•ng c·ª• nh√† b·∫øp", "ƒê√®n", "Trang tr√≠ ti·ªác t√πng", "B·∫£o h·ªô gia ƒë√¨nh"].map(l2 => ({ l1: "Nh√† c·ª≠a & ƒê·ªùi s·ªëng", l2: l2, fee: 10.0 })),
        ...["Ph·ª• ki·ªán xe m√°y", "M≈© b·∫£o hi·ªÉm & Ph·ª• ki·ªán", "Ph·ª• t√πng xe m√°y"].map(l2 => ({ l1: "M√¥ t√¥, xe m√°y", l2: l2, fee: 10.0 })),
        ...["H·ªça c·ª•", "Qu√† T·∫∑ng - Gi·∫•y G√≥i", "Th∆∞ T√≠n", "S·ªï & Gi·∫•y C√°c Lo·∫°i", "Thi·∫øt B·ªã Tr∆∞·ªùng H·ªçc", "B√∫t C√°c Lo·∫°i"].map(l2 => ({ l1: "VƒÉn Ph√≤ng Ph·∫©m", l2: l2, fee: 10.0 }))
    ];

    // Input & Element References (Gi·ªØ nguy√™n)
    const giaNhapInput = document.getElementById('giaNhap');
    const giaBanInput = document.getElementById('giaBan');
    const nganhHangL1Select = document.getElementById('nganhHangL1');
    const nganhHangL2Select = document.getElementById('nganhHangL2');
    const phiCoDinhDisplay = document.getElementById('phiCoDinhDisplay');
    const tyLeThueInput = document.getElementById('tyLeThue');
    const phanTramQuangCaoInput = document.getElementById('phanTramQuangCao');
    const phanTramAffiliateInput = document.getElementById('phanTramAffiliate');
    const phanTramVoucherInput = document.getElementById('phanTramVoucher');
    const phanTramMktKhacInput = document.getElementById('phanTramMktKhac');
    const tyLeVanHanhInput = document.getElementById('tyLeVanHanh');
    const tyLeBatThuongInput = document.getElementById('tyLeBatThuong');
    const useVoucherXtraCheckbox = document.getElementById('useVoucherXtra');
    const chiPhiDongGoiInput = document.getElementById('chiPhiDongGoi');
    const chiPhiMktCoDinhInput = document.getElementById('chiPhiMktCoDinh');
    const tyLeHoanInput = document.getElementById('tyLeHoan');
    const chiPhiXuLyHoanInput = document.getElementById('chiPhiXuLyHoan');
    const tinhToanBtn = document.getElementById('tinhToanBtn');
    const resetBtn = document.getElementById('resetBtn');
    const ketQuaTrucTiepDiv = document.getElementById('ketQuaTrucTiep');
    const tooltipBox = document.getElementById('tooltip-box');
    const form = document.getElementById('shopee-profit-form');

    // Error Elements (Gi·ªØ nguy√™n)
    const errorGiaNhap = document.getElementById('errorGiaNhap');
    const errorGiaBan = document.getElementById('errorGiaBan');
    const errorNganhHangL1 = document.getElementById('errorNganhHangL1');
    const errorNganhHangL2 = document.getElementById('errorNganhHangL2');
    const errorThue = document.getElementById('errorThue');
    const errorQuangCao = document.getElementById('errorQuangCao');
    const errorAffiliate = document.getElementById('errorAffiliate');
    const errorVoucher = document.getElementById('errorVoucher');
    const errorMktKhac = document.getElementById('errorMktKhac');
    const errorVanHanh = document.getElementById('errorVanHanh');
    const errorBatThuong = document.getElementById('errorBatThuong');
    const errorDongGoi = document.getElementById('errorDongGoi');
    const errorMktCoDinh = document.getElementById('errorMktCoDinh');
    const errorTyLeHoan = document.getElementById('errorTyLeHoan');
    const errorXuLyHoan = document.getElementById('errorXuLyHoan');

    // --- JavaScript Logic ---
    // Helper Functions (Gi·ªØ nguy√™n)
    function formatCurrency(value) { /* ... */ }
    function clearErrors() { /* ... */ }
    function validateInput(inputElement, errorElement, message, allowZero = false, isPositive = false) { /* ... */ }
    function validateSelect(selectElement, errorElement, message) { /* ... */ }
    // Dropdown Logic (Gi·ªØ nguy√™n)
    function populateL1Dropdown() { /* ... */ }
    function updateL2Dropdown() { /* ... */ }
    function updateFeeDisplay() { /* ... */ }
    // Tooltip Logic (Gi·ªØ nguy√™n)
    let currentTooltipTarget = null;
    let tooltipTimeout = null;
    function showTooltip(iconElement) { /* ... */ }
    function hideTooltip(delay = 0) { /* ... */ }
    // Debounce Function (Gi·ªØ nguy√™n - c√≥ th·ªÉ kh√¥ng d√πng ƒë·∫øn nh∆∞ng v·∫´n h·ªØu √≠ch)
    function debounce(func, wait) { /* ... */ }
    // Calculation Logic (Gi·ªØ nguy√™n)
    function tinhLoiNhuan() { /* ... */ }

    // --- COPY/PASTE CODE JAVASCRIPT HO√ÄN CH·ªàNH T·ª™ PHI√äN B·∫¢N TR∆Ø·ªöC V√ÄO ƒê√ÇY ---
    // --- ƒê·∫¢M B·∫¢O KH√îNG C√ì KH·ªêI CODE G·∫ÆN LISTENER "INPUT"/"CHANGE" G·ªåI TINHLOINHUAN ---
     function formatCurrency(value) {
        const numValue = Number(value);
        if (isNaN(numValue)) return 'L·ªói';
        return Math.round(numValue).toLocaleString('vi-VN');
    }

    function clearErrors() {
        const errorElements = document.querySelectorAll('.error');
        errorElements.forEach(el => el.textContent = '');
    }

    function validateInput(inputElement, errorElement, message, allowZero = false, isPositive = false) {
        if (!inputElement || !errorElement) return true;
        if (inputElement.disabled) { errorElement.textContent = ''; return true; }

        const valueStr = inputElement.value.trim();
        const fieldName = message || inputElement.previousElementSibling?.textContent?.replace('(VNƒê)', '').replace('%', '').trim() || inputElement.id;

        if (valueStr === '') {
            errorElement.textContent = `Vui l√≤ng nh·∫≠p ${fieldName}.`;
            return false;
        }
        const valueNum = parseFloat(valueStr);
        if (isNaN(valueNum)) {
            errorElement.textContent = `Vui l√≤ng nh·∫≠p s·ªë h·ª£p l·ªá cho ${fieldName}.`;
            return false;
        }
        if (valueNum < 0) {
            errorElement.textContent = `${fieldName} kh√¥ng ƒë∆∞·ª£c √¢m.`;
            return false;
        }
        if (!allowZero && valueNum === 0) {
             errorElement.textContent = `${fieldName} ph·∫£i l·ªõn h∆°n 0.`;
             return false;
         }
        if (isPositive && valueNum <= 0) {
             errorElement.textContent = `${fieldName} ph·∫£i l√† s·ªë d∆∞∆°ng.`;
             return false;
         }
        errorElement.textContent = '';
        return true;
    }

    function validateSelect(selectElement, errorElement, message) {
        if (!selectElement || !errorElement) return true;
        if (selectElement.disabled) { errorElement.textContent = ''; return true; }

        if (selectElement.value === '') {
            errorElement.textContent = message;
            return false;
        }
        errorElement.textContent = '';
        return true;
    }

    function populateL1Dropdown() {
        if (!categoryData || categoryData.length === 0) {
            nganhHangL1Select.innerHTML = '<option value="">D·ªØ li·ªáu ng√†nh h√†ng kh√¥ng kh·∫£ d·ª•ng</option>';
            nganhHangL1Select.disabled = true;
            return;
        }
        nganhHangL1Select.innerHTML = '<option value="">-- Ch·ªçn C·∫•p 1 --</option>';
        const l1Categories = [...new Set(categoryData.map(item => item.l1))].sort();
        l1Categories.forEach(l1 => {
            const option = document.createElement('option');
            option.value = l1;
            option.textContent = l1;
            nganhHangL1Select.appendChild(option);
        });
         nganhHangL1Select.disabled = false;
    }

    function updateL2Dropdown() {
        const selectedL1 = nganhHangL1Select.value;
        nganhHangL2Select.innerHTML = '<option value="">-- Ch·ªçn C·∫•p 2 --</option>';
        phiCoDinhDisplay.textContent = 'Ch∆∞a ch·ªçn ng√†nh h√†ng';
        nganhHangL2Select.disabled = true;
        if (errorNganhHangL1) errorNganhHangL1.textContent = '';
        if (errorNganhHangL2) errorNganhHangL2.textContent = '';

        if (selectedL1) {
            const l2Categories = categoryData
                .filter(item => item.l1 === selectedL1)
                .map(item => item.l2)
                .sort();

            if (l2Categories.length > 0) {
                l2Categories.forEach(l2 => {
                    const option = document.createElement('option');
                    option.value = l2;
                    option.textContent = l2;
                    nganhHangL2Select.appendChild(option);
                });
                nganhHangL2Select.disabled = false;
            } else {
                phiCoDinhDisplay.textContent = 'Kh√¥ng c√≥ C·∫•p 2 cho ng√†nh n√†y';
            }
        }
    }

    function updateFeeDisplay() {
        const selectedL1 = nganhHangL1Select.value;
        const selectedL2 = nganhHangL2Select.value;
        if (errorNganhHangL2) errorNganhHangL2.textContent = '';

        if (selectedL1 && selectedL2) {
            const category = categoryData.find(item => item.l1 === selectedL1 && item.l2 === selectedL2);
            if (category) {
                phiCoDinhDisplay.textContent = `${category.fee.toFixed(1)}%`;
            } else {
                phiCoDinhDisplay.textContent = 'L·ªói t√¨m ph√≠';
                console.error(`Could not find fee for L1: ${selectedL1}, L2: ${selectedL2}`);
            }
        } else if (selectedL1 && !selectedL2) {
             phiCoDinhDisplay.textContent = 'Vui l√≤ng ch·ªçn C·∫•p 2';
        } else {
            phiCoDinhDisplay.textContent = 'Ch∆∞a ch·ªçn ng√†nh h√†ng';
        }
    }

     function showTooltip(iconElement) {
        clearTimeout(tooltipTimeout);
        const tooltipText = iconElement.getAttribute('data-tooltip');
        if (!tooltipText || tooltipText.trim() === '' || !tooltipBox) {
            return;
        }
        tooltipBox.textContent = tooltipText;
        tooltipBox.style.display = 'block';
        tooltipBox.style.opacity = '0';
        tooltipBox.classList.add('visible');

        const iconRect = iconElement.getBoundingClientRect();
        const tooltipRect = tooltipBox.getBoundingClientRect();

        let top = iconRect.top + window.scrollY - tooltipRect.height - 10;
        let left = iconRect.left + window.scrollX + (iconRect.width / 2) - (tooltipRect.width / 2);

        if (top < window.scrollY + 5) {
            top = iconRect.bottom + window.scrollY + 10;
        }
        const viewportWidth = document.documentElement.clientWidth;
        if (left < window.scrollX + 5) {
            left = window.scrollX + 5;
        } else if (left + tooltipRect.width > viewportWidth - 5) {
            left = viewportWidth - tooltipRect.width - 5;
        }

        tooltipBox.style.top = `${top}px`;
        tooltipBox.style.left = `${left}px`;
        tooltipBox.style.opacity = '1';
        currentTooltipTarget = iconElement;
    }

     function hideTooltip(delay = 0) {
        clearTimeout(tooltipTimeout);
        if (delay > 0) {
            tooltipTimeout = setTimeout(() => {
                if (tooltipBox) {
                    tooltipBox.style.opacity = '0';
                    tooltipBox.addEventListener('transitionend', function handleTransitionEnd() {
                        tooltipBox.style.display = 'none';
                        tooltipBox.classList.remove('visible');
                        tooltipBox.removeEventListener('transitionend', handleTransitionEnd);
                    }, { once: true });
                }
                currentTooltipTarget = null;
            }, delay);
        } else {
            if (tooltipBox) {
                tooltipBox.style.opacity = '0';
                tooltipBox.style.display = 'none';
                tooltipBox.classList.remove('visible');
            }
            currentTooltipTarget = null;
        }
    }

    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func.apply(this, args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    function tinhLoiNhuan() {
        clearErrors();
        if (ketQuaTrucTiepDiv) {
             ketQuaTrucTiepDiv.innerHTML = '';
             ketQuaTrucTiepDiv.className = 'ketQuaTrucTiep';
             ketQuaTrucTiepDiv.classList.remove('visible');
             ketQuaTrucTiepDiv.style.maxHeight = '0';
             ketQuaTrucTiepDiv.style.opacity = '0';
        }

        let formIsValid = true;
        formIsValid &= validateInput(giaNhapInput, errorGiaNhap, 'Gi√° nh·∫≠p', true);
        formIsValid &= validateInput(giaBanInput, errorGiaBan, 'Gi√° b√°n', false, true);
        formIsValid &= validateSelect(nganhHangL1Select, errorNganhHangL1, 'Vui l√≤ng ch·ªçn Ng√†nh h√†ng C·∫•p 1.');
        formIsValid &= validateSelect(nganhHangL2Select, errorNganhHangL2, 'Vui l√≤ng ch·ªçn Ng√†nh h√†ng C·∫•p 2.');
        formIsValid &= validateInput(tyLeThueInput, errorThue, '% Thu·∫ø', true);
        formIsValid &= validateInput(phanTramQuangCaoInput, errorQuangCao, '% Qu·∫£ng c√°o Shopee', true);
        formIsValid &= validateInput(phanTramAffiliateInput, errorAffiliate, '% Affiliate', true);
        formIsValid &= validateInput(phanTramVoucherInput, errorVoucher, '% Voucher/KM', true);
        formIsValid &= validateInput(phanTramMktKhacInput, errorMktKhac, '% MKT kh√°c', true);
        formIsValid &= validateInput(tyLeVanHanhInput, errorVanHanh, '% V·∫≠n H√†nh', true);
        formIsValid &= validateInput(tyLeBatThuongInput, errorBatThuong, '% B·∫•t Th∆∞·ªùng', true);
        formIsValid &= validateInput(chiPhiDongGoiInput, errorDongGoi, 'Chi ph√≠ ƒë√≥ng g√≥i', true);
        formIsValid &= validateInput(chiPhiMktCoDinhInput, errorMktCoDinh, 'Chi ph√≠ MKT c·ªë ƒë·ªãnh', true);
        formIsValid &= validateInput(tyLeHoanInput, errorTyLeHoan, '% T·ª∑ l·ªá ho√†n', true);
        formIsValid &= validateInput(chiPhiXuLyHoanInput, errorXuLyHoan, 'Ph√≠ x·ª≠ l√Ω ƒë∆°n ho√†n', true);

        if (!formIsValid) {
            if (ketQuaTrucTiepDiv) {
                 ketQuaTrucTiepDiv.innerHTML = '<div class="error" style="text-align: center; font-weight: bold;">Vui l√≤ng ki·ªÉm tra l·∫°i c√°c √¥ nh·∫≠p li·ªáu c√≥ l·ªói.</div>';
                 ketQuaTrucTiepDiv.style.maxHeight = '100px';
                 ketQuaTrucTiepDiv.style.opacity = '1';
                 ketQuaTrucTiepDiv.classList.add('visible');
                 ketQuaTrucTiepDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
             const firstError = form.querySelector('.error:not(:empty)');
             if (firstError) {
                 const inputId = firstError.id.replace('error', '');
                 const inputElement = document.getElementById(inputId);
                 if (inputElement) {
                    inputElement.focus();
                    inputElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                 } else {
                    // Fallback if input not found by id convention
                     firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                 }
             }
            return;
        }

        const giaNhap = parseFloat(giaNhapInput.value) || 0;
        const giaBan = parseFloat(giaBanInput.value) || 0;
        const selectedL1 = nganhHangL1Select.value;
        const selectedL2 = nganhHangL2Select.value;
        const categoryInfo = categoryData.find(item => item.l1 === selectedL1 && item.l2 === selectedL2);

        if (!categoryInfo) {
            if (ketQuaTrucTiepDiv) {
                ketQuaTrucTiepDiv.innerHTML = '<div class="error" style="text-align: center; font-weight: bold;">L·ªói: Kh√¥ng t√¨m th·∫•y ph√≠ cho ng√†nh h√†ng ƒë√£ ch·ªçn.</div>';
                ketQuaTrucTiepDiv.style.maxHeight = '100px';
                ketQuaTrucTiepDiv.style.opacity = '1';
                ketQuaTrucTiepDiv.classList.add('visible');
                ketQuaTrucTiepDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            console.error("Category fee not found for:", selectedL1, selectedL2);
            return;
        }

        const tyLePhiCoDinh = categoryInfo.fee / 100;
        const tyLeThue = (parseFloat(tyLeThueInput.value) || 0) / 100;
        const phanTramQuangCao = (parseFloat(phanTramQuangCaoInput.value) || 0) / 100;
        const phanTramAffiliate = (parseFloat(phanTramAffiliateInput.value) || 0) / 100;
        const phanTramVoucher = (parseFloat(phanTramVoucherInput.value) || 0) / 100;
        const phanTramMktKhac = (parseFloat(phanTramMktKhacInput.value) || 0) / 100;
        const tyLeVanHanh = (parseFloat(tyLeVanHanhInput.value) || 0) / 100;
        const tyLeBatThuong = (parseFloat(tyLeBatThuongInput.value) || 0) / 100;
        const useVX = useVoucherXtraCheckbox.checked;
        const chiPhiDongGoi = parseFloat(chiPhiDongGoiInput.value) || 0;
        const chiPhiMktCoDinh = parseFloat(chiPhiMktCoDinhInput.value) || 0;
        const tyLeHoan = (parseFloat(tyLeHoanInput.value) || 0) / 100;
        const chiPhiXuLyHoan = parseFloat(chiPhiXuLyHoanInput.value) || 0;

        const cpPhiCoDinh = giaBan * tyLePhiCoDinh;
        const cpPhiThanhToan = giaBan * CONFIG.TYLE_PHI_THANH_TOAN_CO_DINH;
        const cpThue = giaBan * tyLeThue;
        const cpQuangCaoRaw = giaBan * phanTramQuangCao;
        const cpVatQuangCao = cpQuangCaoRaw * CONFIG.TYLE_VAT_QUANG_CAO;
        const cpQuangCaoTotal = cpQuangCaoRaw + cpVatQuangCao;
        const cpAffiliate = giaBan * phanTramAffiliate;
        const cpVoucher = giaBan * phanTramVoucher;
        const cpMktKhacPercent = giaBan * phanTramMktKhac;
        const cpVanHanh = giaBan * tyLeVanHanh;
        const cpBatThuong = giaBan * tyLeBatThuong;
        let cpVX = 0;
        if (useVX) { cpVX = Math.min(giaBan * CONFIG.TYLE_VOUCHER_XTRA, CONFIG.MAX_PHI_VOUCHER_XTRA); }
        const cpDongGoi = chiPhiDongGoi;
        const cpMktCoDinh = chiPhiMktCoDinh;
        const cpHoanTrungBinh = tyLeHoan * chiPhiXuLyHoan;

        const tongChiPhiTruGiaNhap =
            cpPhiCoDinh + cpPhiThanhToan + cpThue + cpQuangCaoTotal + cpAffiliate +
            cpVoucher + cpMktKhacPercent + cpVanHanh + cpBatThuong + cpVX +
            cpDongGoi + cpMktCoDinh + cpHoanTrungBinh;

        const tongChiPhiBaoGomGiaGoc = tongChiPhiTruGiaNhap + giaNhap;
        const loiNhuan = giaBan - tongChiPhiBaoGomGiaGoc;
        const tySuatLoiNhuan = giaBan > 0 ? (loiNhuan / giaBan) * 100 : 0;

        if (ketQuaTrucTiepDiv) {
             let resultText = '';
             let resultClass = '';
             let colorClass = '';

             if (loiNhuan > 0.001) {
                 resultClass = 'result-positive';
                 colorClass = 'positive';
                 resultText = 'L·ª£i nhu·∫≠n ∆∞·ªõc t√≠nh:';
             } else if (loiNhuan < -0.001) {
                 resultClass = 'result-negative';
                 colorClass = 'negative';
                 resultText = 'L·ªó ∆∞·ªõc t√≠nh:';
             } else {
                 resultClass = 'result-zero';
                 colorClass = 'zero';
                 resultText = 'H√≤a v·ªën ∆∞·ªõc t√≠nh:';
             }

             ketQuaTrucTiepDiv.innerHTML = `
                <div class="result-text">${resultText}</div>
                <span class="result-amount ${colorClass}">${formatCurrency(loiNhuan)} VNƒê</span>
                <span class="sub-info">
                    T·ª∑ su·∫•t LN/Gi√° b√°n: <strong class="${colorClass}">${tySuatLoiNhuan.toFixed(2)}%</strong> |
                    T·ªïng CP/ƒë∆°n: ${formatCurrency(tongChiPhiBaoGomGiaGoc)} VNƒê <br>
                    (Ph√≠ Cƒê: ${formatCurrency(cpPhiCoDinh)} | Ph√≠ TT: ${formatCurrency(cpPhiThanhToan)}${useVX ? ` | VX: ${formatCurrency(cpVX)}` : ''})
                </span>
            `;
            ketQuaTrucTiepDiv.classList.add(resultClass);

            requestAnimationFrame(() => {
                ketQuaTrucTiepDiv.style.maxHeight = ketQuaTrucTiepDiv.scrollHeight + 'px';
                ketQuaTrucTiepDiv.style.opacity = '1';
                ketQuaTrucTiepDiv.classList.add('visible');
                setTimeout(() => {
                    ketQuaTrucTiepDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 50);
            });
        }
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', () => {
        populateL1Dropdown();

        // Tooltip listeners (Gi·ªØ nguy√™n)
        const container = document.querySelector('.container');
        if (container) {
             container.addEventListener('click', function(event) {
                 const target = event.target;
                 if (target.classList.contains('info-icon')) {
                     event.stopPropagation();
                     if (target === currentTooltipTarget) {
                         hideTooltip();
                     } else {
                         hideTooltip();
                         showTooltip(target);
                     }
                 }
             });
         }
         document.addEventListener('click', function(event) {
             if (currentTooltipTarget && tooltipBox && !tooltipBox.contains(event.target) && !event.target.classList.contains('info-icon')) {
                 hideTooltip(100);
             }
         });

        // Dropdown listeners (Ch·ªâ c·∫≠p nh·∫≠t UI, kh√¥ng validate/t√≠nh to√°n)
        if(nganhHangL1Select) nganhHangL1Select.addEventListener('change', () => {
            updateL2Dropdown();
            updateFeeDisplay();
            // KH√îNG validateSelect ·ªü ƒë√¢y
        });
        if(nganhHangL2Select) nganhHangL2Select.addEventListener('change', () => {
            updateFeeDisplay();
            // KH√îNG validateSelect ·ªü ƒë√¢y
        });

        // Button listeners (G·ªçi tr·ª±c ti·∫øp tinhLoiNhuan)
        if(tinhToanBtn) tinhToanBtn.addEventListener('click', tinhLoiNhuan);
        if(resetBtn) resetBtn.addEventListener('click', () => {
            if (form) form.reset();
            if (nganhHangL1Select) nganhHangL1Select.value = '';
            updateL2Dropdown();
            if(ketQuaTrucTiepDiv) {
                 ketQuaTrucTiepDiv.innerHTML = '';
                 ketQuaTrucTiepDiv.className = 'ketQuaTrucTiep';
                 ketQuaTrucTiepDiv.classList.remove('visible');
                 ketQuaTrucTiepDiv.style.maxHeight = '0';
                 ketQuaTrucTiepDiv.style.opacity = '0';
            }
            clearErrors();
            hideTooltip();
            if(giaNhapInput) giaNhapInput.focus();
        });
        if (form) {
            form.addEventListener('keypress', function(event) {
                if (event.key === 'Enter' && event.target.tagName !== 'TEXTAREA') {
                     event.preventDefault();
                     tinhLoiNhuan(); // G·ªçi h√†m t√≠nh to√°n khi nh·∫•n Enter
                }
            });
        }
    });

</script>
</body>
</html>
